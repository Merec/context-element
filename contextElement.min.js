/*!
 * The MIT License (MIT)
 *
 * Copyright (c) 2013 Stefan Sch√§fer
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to
 * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
 * the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.

 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
(function(e){var b="[data-toggle=contextElement]";var d=[];var c=function(h,g){var i=this;this.element=e(h);this.options=e.extend({},c.DEFAULTS,g);if(this.element.attr("data-target")){this.options.target=e(this.element.attr("data-target"))}if(this.element.attr("data-source")){this.options.target=e(this.element.attr("data-source"))}if(this.element.attr("data-sourceLoadingText")){this.options.target=e(this.element.attr("data-source"))}if(this.element.attr("data-displayTimeout")){this.options.displayTimeout=parseInt(this.element.attr("data-displayTimeout"))}if(this.element.attr("data-mouseOutTimeout")){this.options.mouseOutTimeout=parseInt(this.element.attr("data-mouseOutTimeout"))}if(this.element.attr("data-modal")){this.options.cursorMargin=!!(e.inArray([true,1,"on","true"],this.element.attr("data-modal"))!==false)}if(this.element.attr("data-cursorMargin")){this.options.cursorMargin=parseInt(this.element.attr("data-cursorMargin"))}if(this.element.attr("data-leftClick")){this.options.leftClick=!!(e.inArray([true,1,"on","true"],this.element.attr("data-leftClick"))!==false)}if(this.element.attr("data-middleClick")){this.options.middleClick=!!(e.inArray([true,1,"on","true"],this.element.attr("data-middleClick"))!==false)}if(this.element.attr("data-rightClick")){this.options.rightClick=!!(e.inArray([true,1,"on","true"],this.element.attr("data-rightClick"))!==false)}if(this.element.attr("data-effect")){this.options.effect=this.element.attr("data-effect")}if(this.element.attr("data-effectDuration")){this.options.effectDuration=parseInt(this.element.attr("data-effectDuration"))}if(this.options.modal){this.options.displayTimeout=0;this.options.mouseOutTimeout=0}this.debug=false;this.debugOnlyConsole=true;this.target=null;this.targetPrepared=false;this.sourceIsLoading=false;this.gotTargetFromSource=false;this.displayContextElement=false;this.isTouchDevice="ontouchstart" in document.documentElement;this.displayTimeoutTimer=null;this.mouseOutTimeoutTimer=null;this.touchDisplayContextElementTimer=true;if(this.options.rightClick){this.element.on("contextmenu",function(j){j.preventDefault()})}if(this.options.source!=null){}};c.DEFAULTS={target:null,source:null,sourceLoadingText:"Loading ...",displayTimeout:2500,mouseOutTimeout:300,modal:false,cursorMargin:5,leftClick:false,middleClick:false,rightClick:true,effect:"fade",effectDuration:150,touch:{cursorMargin:20,displayAfterTime:500,displayTimeout:0},ajax:{},events:{beforeDisplay:"beforeDisplay.bs.contextElement",onDisplay:"onDisplay.bs.contextElement",beforeHide:"beforeHide.bs.contextElement",onHidden:"onHidden.bs.contextElement",sourceLoading:"sourceLoading.bs.contextElement",sourceLoaded:"sourceLoaded.bs.contextElement"}};c.prototype.debugMessage=function(g){if(!this.debug){return}if(!this.debugOnlyConsole){this.element.html(this.element.html()+g+"<br />")}console.log(g)};c.prototype.prepareTarget=function(l){if(this.targetPrepared){return true}var k=this;if(this.options.source){if(typeof this.options.source=="string"&&!this.gotTargetFromSource){if(this.sourceIsLoading){return false}this.sourceIsLoading=true;var j=(typeof this.options.sourceLoadingText=="function ")?this.options.sourceLoadingText():this.options.sourceLoadingText;if(j){var i=this.options.displayTimeout;var g=this.options.touch.displayTimeout;this.options.displayTimeout=0;this.options.touch.displayTimeout=0;var h=e("<div></div>").css({display:"none",position:"absolute"}).html(j);if(!this.target||this.target.length==0){e(document.body).append(h)}else{this.target.replaceWith(h)}this.target=h;this.display()}this.element.trigger(this.options.events.sourceLoading);e.ajax(this.options.source,this.options.ajax).done(function(n){k.options.displayTimeout=i;k.options.touch.displayTimeout=g;k.targetIsSourceLoading=false;var m=e(n);k.target.replaceWith(m);k.target=m;k.gotTargetFromSource=true;k.sourceIsLoading=false;k.element.trigger(k.options.events.sourceLoaded);k.show(l)});return false}else{if(typeof this.options.source=="function"){var h=e("<div></div>").css({display:"none",position:"absolute"}).html(this.options.source());if(this.target&&this.target.length>0){this.target.replaceWith(h)}this.target=h}}this.gotTargetFromSource=false}else{this.target=e(this.options.target)}this.target.css({position:"absolute",display:"none"});e(document.body).append(this.target);this.target.hover(function(){if(k.displayTimeoutTimer!=null){window.clearTimeout(k.displayTimeoutTimer);k.displayTimeoutTimer=null}if(k.mouseOutTimeoutTimer!=null){window.clearTimeout(k.mouseOutTimeoutTimer);k.mouseOutTimeoutTimer=null}},function(){if(k.options.mouseOutTimeout>0){k.mouseOutTimeoutTimer=window.setTimeout(function(){k.element.contextElement("hide")},k.options.mouseOutTimeout)}});if(!this.options.source){this.targetPrepared=true}return true};c.prototype.show=function(h){var g=this;if(this.isTouchDevice){this.showTouch(h);return}if(h.type=="mousedown"){if(h.which==1&&!this.options.leftClick){return}if(h.which==2&&!this.options.middleClick){return}if(h.which==3&&!this.options.rightClick){return}this.displayContextElement=true;return}if(!this.displayContextElement){return}this.lastPointsToDisplayAt={x:h.pageX,y:h.pageY};if(!this.prepareTarget(h)){return}this.displayContextElement=false;this.display()};c.prototype.showTouch=function(h){var g=this;if(h.type=="touchstart"){this.lastPointsToDisplayAt={x:h.originalEvent.touches[0].pageX,y:h.originalEvent.touches[0].pageY};if(this.options.touch.displayAfterTime){this.touchDisplayContextElementTimer=window.setTimeout(function(){g.displayContextElement=true;g.touchDisplayContextElementTimer=null},this.options.touch.displayAfterTime);return}}if(this.touchDisplayContextElementTimer!=null){window.clearTimeout(this.touchDisplayContextElementTimer);this.touchDisplayContextElementTimer=null}if(!this.displayContextElement){return}this.displayContextElement=false;this.display()};c.prototype.touchmove=function(g){if(this.touchDisplayContextElementTimer!=null){window.clearTimeout(this.touchDisplayContextElementTimer);this.touchDisplayContextElementTimer=null}};c.prototype.display=function(g,l){if(!g&&this.lastPointsToDisplayAt.x){g=this.lastPointsToDisplayAt.x}else{throw"No position X given"}if(!l&&this.lastPointsToDisplayAt.y){l=this.lastPointsToDisplayAt.y}else{throw"No position Y given"}var j=this;if(!this.target||this.target.length==0){return}if(!this.sourceIsLoading){this.element.trigger(this.options.events.beforeDisplay)}var h=(this.isTouchDevice)?this.options.touch.cursorMargin:this.options.cursorMargin;this.target.css({left:g+h,top:l+h});if(this.options.effect=="slide"){this.target.finish().slideDown(this.options.effectDuration)}else{if(this.options.effect=="fade"){this.target.finish().fadeIn(this.options.effectDuration)}else{this.target.finish().show()}}var k=g+this.target.outerWidth()+h;if(e(window).innerWidth()<k){this.target.css("left",g-this.target.outerWidth()-h)}var i=l+this.target.outerHeight()+h;if(e(window).innerHeight()+e(window).scrollTop()<i){this.target.css("top",l-this.target.outerHeight()-h)}if(!this.sourceIsLoading){this.element.trigger(this.options.events.onDisplay)}if(this.isTouchDevice){if(this.options.touch.displayTimeout>0){this.displayTimeoutTimer=window.setTimeout(function(){j.hide()},this.options.touch.displayTimeout)}}else{if(this.options.displayTimeout>0){this.displayTimeoutTimer=window.setTimeout(function(){j.hide()},this.options.displayTimeout)}}};c.prototype.hide=function(){if(!this.target){return}this.element.trigger(this.options.events.beforeHide);if(this.options.effect=="slide"){this.target.stop().slideUp(this.options.effectDuration)}else{if(this.options.effect=="fade"){this.target.stop().fadeOut(this.options.effectDuration)}else{this.target.stop().hide()}}if(this.displayTimeoutTimer!=null){window.clearTimeout(this.displayTimeoutTimer);this.displayTimeoutTimer=null}if(this.mouseOutTimeoutTimer!=null){window.clearTimeout(this.mouseOutTimeoutTimer);this.mouseOutTimeoutTimer=null}this.element.trigger(this.options.events.onHidden)};c.prototype.hideIfNotModal=function(){if(!this.options.modal){this.hide()}};function f(g){e(b).each(function(){e(this).contextElement("hideIfNotModal",g)});e(d).each(function(){e(this).contextElement("hideIfNotModal",g)})}var a=e.fn.contextElement;e.fn.contextElement=function(g,h){return this.each(function(){var k=e(this);var j=k.data("bs.contextElement");var i=e.extend({},c.DEFAULTS,k.data(),typeof g=="object"&&g);if(!j){k.data("bs.contextElement",(j=new c(this,i)))}if(typeof g=="string"){j[g](h)}if(!h){k.on("mousedown.bs.contextElement.data-api",function(l){e(this).contextElement("show",l)}).on("mouseup.bs.contextElement.data-api",function(l){e(this).contextElement("show",l)});d.push(k)}})};e.fn.contextElement.Constructor=c;e.fn.contextElement.noConflict=function(){e.fn.contextElement=a;return this};e(document).on("mousedown.bs.contextElement.data-api",f).on("mousedown.bs.contextElement.data-api",b,function(g){e(this).contextElement("show",g)}).on("mouseup.bs.contextElement.data-api",b,function(g){e(this).contextElement("show",g)}).on("touchstart.bs.contextElement.data-api",b,function(g){e(this).contextElement("show",g)}).on("touchend.bs.contextElement.data-api",b,function(g){e(this).contextElement("show",g)}).on("touchmove.bs.contextElement.data-api",b,function(g){e(this).contextElement("touchmove",g)})})(window.jQuery);